# gethapi-example

Simple TCP server as example of GETH + Postgres Cache interaction

## Задача

Приложение на Go должно быть реализовано в виде простого TCP сервера, способного исполнять два метода посредством взаимодействия с нодой Geth.

## Установка и Запуск

Для тестовой среды должны быть установлены `docker` + `docker-compose`. Если он есть то
- *./up.sh* - поднимает сервисы блокчейна, базы данных и сервера API
- *./geth.sh* - добавит по 100ETH на 10 аккаунтов и откроет консоль GETH
- *./pgsql.sh* - откроет консоль PostgreSQL

Сервер поднимется на порту :9091, к нему можно обращаться телнетом

## Демо

3х минутная демонстрация примера 
https://www.screencast.com/t/5Iivp7zqBA7z

## Методы

Готовое приложение должно иметь два метода:

1. **SendEth**, который отправляет ETH с одного из кошельков на указанный кошелек пользователя. Метод имеет следующие параметры:
- **from** - адрес кошелька, откуда нужно отправить ETH.
- **to** - адрес кошелька, куда нужно отправить ETH.
- **amount** - сумма перевода в ETH.

2. **GetLast**, который возвращает массив объектов в формате JSON, содержащий информацию о последних поступлениях на кошельки. Последними считаются поступления, которые либо еще не запрашивались данным методом, либо имеют < 3 подтверждений на момент запроса. Объекты массива имеют следующие поля:
- **date** - дата поступления.
- **address** - адрес, на который был произведен перевод
- **amount** - сумма перевода в ETH.
- **confirmations** - количество подтверждений транзакции. (Если подтверждений нет, но перевод зафиксирован, то возвращать 0)

### База данных

Приложение должно использовать базу данных на pgsql, в которой должны храниться следующие данные:
- Информация об имеющихся кошельках с актуальным балансом.
- Информация обо всех транзакциях на вывод с информацией о том, с какого кошелька был произведен перевод.
- Информация обо всех транзакциях на ввод, с актуальным числом подтверждений (если подтверждений уже > 6, можно не обновлять)


### На что нужно обратить внимание:

- Безопасность. В приложении не должно быть уязвимостей, позволяющих произвольным образом отдать команду Geth, изменить значение в базе.
- Race Condition - необходимо должным образом общаться с базой и Geth, чтобы не возникало состояние гонки.
- Нагрузки - приложение не должно ложится хотя бы от тысячи запросов в секунду.
- Ну и чтобы явного говнокода и костылей не было. Неявные можно, сами такие любим.


### LICENSE

MIT.
